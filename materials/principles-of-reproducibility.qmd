---
title: "Introduction and Principles of reproducibility"
toc: true
toc-location: right
---

```{r}
#| echo: false
library(tidyverse)
```


# Introduction

## Programme Overview

### What this training is and is not

Chosen topics are: foundational, widely applicable, and transferable conceptually.

It is

-   ‚úÖ An introduction to R for those without previous experience
-   ‚úÖ About using RStudio Projects and good practice for code and project documentation and organisation
-   ‚úÖ An introduction to the tidyverse

It is not

-   ‚ùå An introduction to statistics
-   ‚ùå Magic

### Learning Objectives

After this workshop the successful learner will be able to:

-   Explain the rationale for scripting analysis
-   Find their way around the RStudio windows
-   Create and plot data using ggplot
-   Know how to load packages
-   Understand what is meant by the working directory, absolute and relative paths and be able to apply these concepts to data import
-   Summarise data in a single group or in multiple groups
-   Develop highly organised analyses including well-commented scripts that can be understood by future you and others

# Principles of reproducibility

## What is reproducibility?

[![The Turing Way's definitions of reproducible research](images/reproducible-matrix.jpg){fig-alt="Two by Two cell matrix. Columns are Data, either same or different. Rows are Analysis either same or different. Each of cells contain one of the definitions for reproducibility"}](https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions#rr-overview-definitions)

**Reproducible: Same data + same analysis = identical results**

*"...obtaining consistent results using the same input data; computational steps, methods, and code; and conditions of analysis. This definition is synonymous with"computational reproducibility"* [@nationalacademiesofsciences2019]. This is what we are concentrating on in the Supporting Information.

-   Replicable: Different data + same analysis = qualitatively similar results. The work is not dependent on the specificities of the data.

-   Robust: Same data + different analysis = qualitatively similar or identical results. The work is not dependent on the specificities of the analysis.

-   Generalisable: Different data + different analysis = qualitatively similar results and same conclusions.

## Why does reproducibility matter?

-   Many high profile cases of work which did not reproduce e.g. Anil Potti unravelled by @baggerly2009

-   Five selfish reasons to work reproducibly [@markowetz2015]. Alternatively, see the very entertaining [talk](https://youtu.be/yVT07Sukv9Q)

-   **Will** become standard in Science and publishing e.g OECD Global Science Forum Building digital workforce capacity and skills for data-intensive science [@oecdglobalscienceforum2020]

## How to achieve reproducibility

-   Reproducibility is a continuum. Some is better than none!

-   Script **everything**

-   Organisation: Project-oriented workflows with file and folder structure, naming things

-   Code: follow a consistent style, organise into sections and scripts (be modular), Code algorithmically

-   Documentation: Readme files, code comments, metadata,

-   More advanced: version, control, continuous integration and testing

## Rationale for scripting

-   Science is the generation of ideas, designing work to test them and reporting the results.

-   We ensure laboratory and field work is replicable, robust and generalisable by planning and recording in lab books and using standard protocols. Repeating results is still hard.

-   Workflows for computational projects, and the data analysis and reporting of other work can, and should, be 100% reproducible!

-   Scripting is the way to achieve this.

## Project-oriented workflow

-   use folders to organise your work

-   you are aiming for structured, systematic and repeatable.

-   inputs and outputs should be clearly identifiable from structure and/or naming

## Further reading

-   Data Organization in Spreadsheets [@broman_data_2018]
-   Ten simple rules for reproducible computational research [@Sandve2013-nd]
-   Best practices for scientific computing [@Wilson2014-ij]
-   Good enough practices in scientific computing [@Wilson2017-cp]
-   Excuse Me, Do You Have a Moment to Talk About Version Control? [@Bryan2018-hl]

# Introduction to R

-   Finding your way round RStudio
-   Typing in data and plotting it
-   Importing data: working directories and paths

## Finding your way round RStudio

### RStudio: live demonstration

-   the panels
    -   Top left: Script - write and edit code and comments to keep
    -  Bottom left: Console - where commands get executed and can be 
       typed
    -   Top right: Environment - where you can see the objects you have
        created; History - of commands
    -   Bottom right: Files - a file explorer; Plots; Packages; Help    
-   making yourself comfortable
-   typing in the console sending commands
-   using R as a calculator
-   assigning values
-   where to see objects
-   using a script - make sure to execute
-   comments \#
-   data types and structures
-   functions `c()`
-   types of R files: `.R`, `.RData` `.RHistory`


### Overview of demonstration

![](https://www-users.york.ac.uk/~er13/RStudio%20Anatomy.svg){width="600"}

üìñ Read [First Steps in RStudio](https://3mmarand.github.io/comp4biosci/first_steps_rstudio.html)

üìπ Watch

{{< video https://www.youtube.com/watch?v=7oLLjkTNrjY >}}

{{< video https://youtu.be/2Ke1FGdaMSI >}}


## Typing in data and plotting it

üé¨ We code together

üõù You try!


### The goal üêà plot

We will work with some data on the coat colour of 62 cats. You are going
to type data in R, summarise and plot it

The data are as a frequency table:

```{r}
#| echo: false
coat <- c("black", 
          "white", 
          "tabby", 
          "ginger", 
          "tortoiseshell", 
          "calico")
freq <- c(23, 15, 8, 10, 5, 1)
df <- data.frame(coat, freq)
knitr::kable(df, 
             table.attr = "style='width:30%;'",
             caption = "Frequency of coat colours in 62 cats",
             format = "html",
             col.names = c("Coat colour", "No. cats"),
             row.names = FALSE) |>  
  kableExtra::kable_styling()
```

You will create a figure like this:

```{r}
#| echo: false
coat_data <- data.frame(coat, freq)
ggplot(data = coat_data, 
       aes(x = coat, y = freq)) +
  geom_col(colour = "black", fill = "lightblue", width = 1) +
  scale_x_discrete(name = "Coat colour",
                   expand = c(0, 0)) +
  scale_y_continuous(name = "Number of cats",
                     expand = c(0, 0),
                     limits = c(0, 25)) +
  theme_classic()
```


### Getting set up

-   üé¨  In RStudio do File | New project | New directory
    Be purposeful about where you create it and name it. I 
    suggest `cats-1`

-   üé¨  Make a new script and save it as `type-data-and-plot.R` to carry out the 
    rest of the work.  


### Creating the data

Start by making a vector called `coat` that holds coat colours

üé¨  Write the following in your script:

```{r}
# coat colours
coat <- c("black", "white", "tabby", "ginger", "tortoiseshell", "calico")
```

The shortcut for `<-` is Alt+- (hold the Alt key down then hit
the minus key ).

Ensure your cursor is on the line with the command and do Control+Enter 
to send the command to the console to be executed. 

I have used a comment. Comment your code as much as possible!

üõù Create a vector called `freq` containing the numbers of cats with each 
coat colour

```{r}
#| code-fold: true
#| code-summary: "Answer - don't look until you have tried!"

# numbers of cats with each coat colour
freq <- c(23, 15, 8, 10, 5, 1)

```

### Packages

Commands like `c()` and `sum()` are in packages which are part
the 'base' R system. A package is a collection of related commands. Base
packages are installed automatically when you install R.

Other packages, such as **`ggplot2`** [@ggplot2] need to be *installed
once*, and then *loaded each session*. **`ggplot2`** is one of the
**`tidyverse`** [@tidyverse] packages.

üé¨  Load the **`tidyverse`**:

```{r}
#| eval: false
library(tidyverse)
```

You will likely be warned of some function name conflicts but these will
not be a problem for you.

### Plotting the data with `ggplot()`

-   `ggplot()` takes a dataframe for an argument
-   We can make a dataframe of the two vectors, `coat` and `freq` 
    using the `data.frame()` function.

üé¨  Make a dataframe called `coat_data`

```{r}
coat_data <- data.frame(coat, freq)
```

üé¨  Click on `coat_data` in the Environment to open a spreadsheet-like 
view of it.

üé¨  Create a simple barplot using `ggplot` like this:

```{r}
ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col()
```

-   `ggplot()` alone creates a blank plot.
-   `ggplot(data = coat_data)` looks the same.
-   `aes()` gives the 'Aesthetic mappings'. How variables (columns) 
    are mapped to visual properties (aesthetics) e.g., axes, colour, 
    shapes.
-   Thus `ggplot(data = coat_data, aes(x = coat, y = freq))` produces 
    a plot with axes
-   `geom_col`: A 'Geom' (Geometric object) gives the visual 
    representations of the data: points, lines, bars, boxplots etc.

Note that `ggplot2` is the name of the package and `ggplot()` is its
most important command.


### Using the help manual

The manual tells us about a function. 'Arguments' can be added to 
the `geom_col()` command inside the brackets.

Commands do something and their arguments (in brackets) and can specify:

-   what object to do it to
-   how exactly to do it

Many arguments have defaults so you don't always need to supply them.



üé¨ Open the manual page for `geom_col()` using:

```{r}
#| eval: false
?geom_col
```

The manual page has several sections.

-   **Description** an overview of what the command does
-   **Usage** lists arguments
    -   form: argument name = default value
    -   some arguments MUST be supplied others have defaults
    -   `...` means etc and includes arguments that can be passed to
        many 'geoms'
-   **Arguments** gives the detail about the arguments
-   **Details** describes how the command works in more detail
-   **Value** gives the output of the command
-   Don't be too perturbed by not fully understanding the information

## Customising a plot

### Bar colour

üé¨ Change the fill of the bars using `fill`:

```{r}

ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue")
```

Colours can be given by their name, "lightblue" or code, "#ADD8E6".

Look up by [name](assets/colournames.pdf) or
[code](assets/colourhex.pdf)

üé¨ Change the bars to a colour you like.

`fill` is one of the arguments covered by `...`. `fill` is an
'aesthetic'. If you look for `...` in the list of arguments you will see
it says:

> Other arguments passed on to layer(). These are often aesthetics, used
> to set an aesthetic to a fixed value, like colour = "red" or size = 3.
> They may also be parameters to the paired geom/stat.

We just set the `fill` aesthetic to a fixed value.

Further down the manual, there is a section on **Aesthetics** which
lists those understood by `geom_col()`

We can set (map) the `fill` aesthetic to a fixed colour inside
`geom_col()` *or* map it to a variable from the dataframe inside the
`aes()` instead. This means the colour will be different for different
values in that variable.

üé¨ Map the `fill` aesthetic to the `coat` variable:

```{r}
ggplot(data = coat_data, aes(x = coat, y = freq, fill = coat)) +
  geom_col()
```

Note that we have taken `fill = "lightblue"` out of the `geom_col()` and
instead put `fill = coat` in the `aes()`.

üõù Use the manual to put the bars next to each
other. Look for the argument that will mean there is no space between
the bars.

```{r}
#| code-fold: true
#| code-summary: "Answer - don't look until you have tried!"

ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue", width = 1)
```

üõù Use the manual to change the colour of the lines
around each bar to black.

```{r}
#| code-fold: true
#| code-summary: "Answer - don't look until you have tried!"

ggplot(data = coat_data,
       aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue", 
           width = 1, 
           colour = "black")
```

### Changing the axes

We can make changes to the axes using:

-   Changes to a discrete x axis: `scale_x_discrete()`
-   Changes to a continuous y axis: `scale_y_continuous()`

`ggplot` automatically extends the axes slightly. You can turn this
behaviour off with the `expand` argument in `scale_x_discrete()` and
`scale_y_continuous()`.[^1]

[^1]: There are also `scale_x_continous()` and `scale_y_discrete()`
    functions when you have those types of variable

üé¨ To remove the gap between the axes and the data:

```{r}
ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue", 
           width = 1, 
           colour = "black") +
  scale_x_discrete(expand = c(0, 0)) + 
  scale_y_continuous(expand = c(0, 0)) 
```

Each 'layer' is added to the ggplot() command with a `+`

::: callout-tip
## Top Tip

Make your code easier to read by using white space and new lines

-   put spaces around `=` , `->` and after `,`
-   use a newline after every comma in a command with lots of arguments
:::

üõù Look up `scale_x_discrete` in the manual and
work out how to change the axis title from "coat" to "Coat colour". Also
change the *y*-axis title.

```{r}
#| code-fold: true
#| code-summary: "Answer - don't look until you have tried!"

ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue", 
           width = 1, 
           colour = "black") +
  scale_x_discrete(expand = c(0, 0),
                   name = "Coat colour") + 
  scale_y_continuous(expand = c(0, 0),
                     name = "Number of cats") 


```

üé¨ I would prefer to see the *y*-axis extend a
little beyond the data and we can change the axis "limits" in the
`scale_y_continuous()`

```{r}
ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(fill = "lightblue", 
           width = 1, 
           colour = "black") +
  scale_x_discrete(expand = c(0, 0),
                   name = "Coat colour") + 
  scale_y_continuous(expand = c(0, 0),
                     name = "Number of cats",
                     limits = c(0, 25)) 


```

### Getting rid of the grey background

The grey grid background is useful for examining plots on a screen but
for a report or publication you will want a more scientific style. Every
aspect of the "theme" of a plot - the non-data elements such as fonts,
background colours, axis line colours etc - can be controlled
individually[^2] but there are some handy built in themes that apply
several changes at once. One of these is `theme_classic()`

[^2]: [Modify components of a
    theme](https://ggplot2.tidyverse.org/reference/theme.html)

üé¨ Add `theme_classic()` to the plot:

```{r}
ggplot(data = coat_data, aes(x = coat, y = freq)) +
  geom_col(width = 1, 
           colour = "black",
           fill = "lightblue") +
  scale_x_discrete(expand = c(0, 0),
                   name = "Coat colour") + 
  scale_y_continuous(expand = c(0, 0),
                     name = "Number of cats",
                     limits = c(0, 25)) +
  theme_classic()


```


## Importing data from files

Typing in data is not practical when you have a lot of it. 
Far more commonly, we import data from a file into R. This requires 
you know two pieces of information.

1.  What format the data are in

    The format of the data determines what *function* you will use to
    import. The file extension often indicates format.

    -   `.txt` a plain text file[^3], where the columns are often
        separated by a space but might also be separated by a tab, a
        backslash or forward slash, or some other character
    -   `.csv` a plain text file where the columns are separated by
        commas
    -   `.xlsx` an Excel file

2.  Where the file is relative to your working directory

    `R` can only read in a file if you say where it is, *i.e.*, you give
    its **relative path**.

[^3]: Plain text files can be opened in notepad or other similar editor
    and still be readable.

We will first save our file for this workshop to our Project
folder and read them in. Then we will then create a new
folder inside our Project folder called `data-raw`, move the data file
into it and read them in from there. This will allow you to see how the
file paths need to be modified when a file is not in your *working
directory*.



### The goal



### Getting set up

-   üé¨  In RStudio do File | New project | New directory
    Be purposeful about where you create it and name it. I 
    suggest `cats-2`

-   üé¨  Make a new script and save it as 
    `import-data-and-summarise-plot.R`.  

-   üé¨  Save this file to your `cats-2` folder: The coat colour and 
    mass of 62 cats - [cat-coats.csv](data-raw/cat-coats.csv)


### Reading in data from the Project folder `cats-2`

CSV files can be read read in with core **`tidyverse`** @tidyverse 
functions.

üé¨ Load the packages

```{r}
library(tidyverse)
```

 A `.csv.` extension suggests this is plain text file with comma 
 separated columns. However, before we attempt to read it it, we
 should take a look at it. We can do this from RStudio

üé¨ Go to the Files pane (bottom right), click on
the `cat-coats.csv` file and choose View File[^4]

[^4]: **Do not** be tempted to import data this way. Unless you are
    careful, your data import will not be scripted or will not be
    scripted correctly.

üé¨ Read in the csv file with:

```{r}
#| eval: false
cats <- read_csv("cat-coats.csv")
```

The data from the file will be read into a dataframe called `cats` and 
you will be able to see it in the Environment.

### Reading in data from a different

To help you understand relative file paths, we will now move the data
file.

üé¨ First remove the dataframes you just created to
make it easier to see whether you can successfully read in the files
from a different place:

```{r}
#| eval: false
rm(cats)
```

üé¨ Now make a new folder called `data-raw`. You can
do this on the Files Pane by clicking New Folder and typing into the box
that appears.

üé¨ Check the boxes next to the file names and
choose More \| Move... and select the `data-raw` folder.


The file will move. To import data from a file in the `data-raw` folder,
you need to give the *relative path* to the file from the working
directory. The working directory is the Project folder, `cats-2` so the
relative path is `data-raw/cat-coats.csv`

üé¨ Import the `cat-coats.csv` data like this:

```{r}
cats <- read_csv("data-raw/cat-coats.csv")
```


## Summarising discrete data: Cat coat

The most appropriate way to summarise nominal data like the colour of
cat coats is to tabulate the number of cats with each colour.

üé¨ Summarise the `cats` dataframe by counting the
number of cats in each category

```{r}
cats |> 
  group_by(coat) |> 
  count()
```

`|>` is the pipe and can be produced with Ctrl+Shift+M

This sort of data might be represented with a barchart. You have two
options for producing that barchart:

1.  plot the summary table using `geom_col()`

2.  plot the raw data using `geom_bar()`

We did the first of these earlier. The
`geom_col()` function uses the numbers in a second column to determine
how high the bars are. However, the `geom_bar()` function will do the
tabulating for you.

üé¨ Plot the coat data using `geom_bar`:

```{r}
ggplot(cats, aes(x = coat)) +
  geom_bar()
```

The gaps that `R` put automatically between the bars reflects that the
coat colours are discrete categories.


## Summarising continuous data

### Cat mass

The variable `mass` in the `cats` dataframe is continuous. Very many
continuous variables have a normal distribution. The normal distribution
is also known as the bell-shaped curve. If we had the mass of all the
cats in the world, we would find many cats were near the mean and fewer
would be away from the mean, either much lighter or much heavier. In
fact 68% would be within one standard deviation of the mean and about
96% would be within two standard deviations.

```{r}
#| echo: false
mean <- mean(cats$mass)
sd <-  sd(cats$mass)

ggplot(data = data.frame(x = c(0, 9)), aes(x)) +
  stat_function(fun = dnorm, n = 101, args = list(mean, sd)) + 
  scale_y_continuous(breaks = NULL, 
                     expand = c(0, 0), 
                     name = "") +
  scale_x_continuous(name = "Mass (kg)", 
                     expand = c(0, 0)) +
  geom_vline(xintercept = mean, size = 2) +
  geom_vline(xintercept = mean - sd, 
             colour = "darkcyan", size = 1) +
  geom_vline(xintercept = mean + sd, 
             colour = "darkcyan", size = 1) +
  geom_label(x = mean, y = 0.25, 
             label = "68%", 
             colour = "darkcyan", 
             size = 10, 
             label.padding = unit(0.5, "lines")) +
  geom_segment(aes(x = mean - sd, y = 0.225, 
                   xend =  mean + sd, yend = 0.225),
               arrow = arrow(length = unit(0.5, "cm"), ends = "both"),
               colour = "darkcyan", 
               size = 1) +
  geom_vline(xintercept = mean - 2 * sd, 
             colour = "mediumpurple3", size = 1) +
  geom_vline(xintercept = mean + 2 * sd, 
             colour = "mediumpurple3", size = 1) +
  geom_label(x = mean, y = 0.15, 
             label = "96%", 
             colour = "mediumpurple3", 
             size = 10, 
             label.padding = unit(0.5, "lines"),) +
  geom_segment(aes(x = mean -  2 * sd, y = 0.125, 
                   xend =  mean + 2 * sd, yend = 0.125),
               arrow = arrow(length = unit(0.5, "cm"), ends = "both"),
               colour = "mediumpurple3", 
               size = 1) +
  theme_classic()

```

üé¨ We can find the mean mass with:

```{r}
cats |> 
  summarise(mean = mean(mass))
```

We can add any sort of summary by placing it inside the the summarise
parentheses. Each one is separated by a comma. We did this to find the
median and the interquatrile range for fly bristles.

üé¨ For example, another way to calculate the number
of values is to use the `length()` function:

```{r}
cats |> 
  summarise(mean = mean(mass),
            n = length(mass))
```

üõù  Adapt the code to calculate the mean, the sample
size *and* the standard deviation (`sd()`)

```{r}
#| code-fold: true
#| code-summary: "Answer - don't look until you have tried!"

cats |> 
  summarise(mean = mean(mass),
            n = length(mass),
            standard_dev = sd(mass))
```

A single continuous variable can be plotted using a histogram to show
the shape of the distribution.

üé¨ Plot a histogram of cats mass:

```{r}
ggplot(cats, aes(x = mass)) +
  geom_histogram(bins = 15, colour = "black") 
```

Notice that there are no gaps between the bars which reflects that
`mass` is continuous. `bins` determines how many groups the variable is
divided up into (*i.e.*, the number of bars) and `colour` sets the colour
for the outline of the bars. A sample of 62 is a relatively small number
of values for plotting a distribution and the number of bins used
determines how smooth or normally distributed the values look.


we will find summary
statistics about mass for each of the coat types.


üé¨ The `group_by()` function is used before the
summarise() to do calculations for each of the coats:

```{r}
cats |> 
  group_by(coat) |> 
  summarise(mean = mean(mass),
                  standard_dev = sd(mass))
```

You can read this as:

> take cats *and then* group by coat *and then* summarise by finding the
> mean of mass and the standard deviation of mass

üõù Why do we get an `NA` for the standard deviation
of the calico cats?






Pages made with R [@R-core], Quarto [@Allaire_Quarto_2024], `knitr` [@knitr1; @knitr2; @knitr3], `kableExtra` [@kableExtra]

# References
